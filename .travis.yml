language: c

compiler:
  - gcc

before_script:
  - mkdir -p /tmp/bin
  - wget https://github.com/cedric-vincent/proot-static-build/raw/master/static/proot-x86_64 -O /tmp/bin/proot
  - chmod +x /tmp/bin/proot
  - export PATH=$PATH:/tmp/bin

script: mkdir build && cd build && cmake ../ && make -j2 all && proot -k 3.16.0 make test

env:
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: "HSX/bfI0onpvursNnS6h+0jkNJehJdvuha64autY388AbZeCwmGnK1omL1J2UOdqQqEAk3X4wykGAloaSnJ1/uKA2My2ObXkBJKucIgCtwekwL4LVyNZ9vlR0iWbQwKCAFFDDPzdUu7NTFFlS0fByskfVknxJxYIcCLYnPbNf9s="

addons:
  coverity_scan:
    project:
      name: "mickael-guene/umeq"
      description: "Build submitted via Travis CI"
    notification_email: mickael.guene@st.com
    build_command_prepend: "cmake ."
    build_command:   "make -j 4"
    branch_pattern: coverity_scan
